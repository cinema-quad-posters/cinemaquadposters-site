<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Poster – Cinema Quad Posters</title> <!-- Placeholder: build.js will replace this with e.g., "ABBA - THE MOVIE (1977) – Original British Quad Poster – Cinema Quad Posters" -->
<meta name="description" content="Original British quad posters for classic films."> <!-- Placeholder: build.js will replace with poster-specific summary -->

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="cqp.css">
<link rel="preload" href="inventory.json" as="fetch" crossorigin>

<style>
.poster-viewer {
    position: relative;
    display: inline-block;
}

.poster-viewer:hover .nav-arrow,
.poster-viewer:hover .enlarge-btn {
    opacity: 1;
}

.nav-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 2rem;
    background: rgba(0,0,0,0.6);
    color: #fff;
    border: none;
    padding: 6px 10px;
    opacity: 0;
    transition: opacity 0.2s;
}

.nav-arrow.left { left: 10px; }
.nav-arrow.right { right: 10px; }

.enlarge-btn {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0,0,0,0.6);
    border: none;
    color: #fff;
    font-size: 1.2rem;
    padding: 6px 8px;
    opacity: 0;
    transition: opacity 0.2s;
    cursor: pointer;
}

.dot-indicators {
    display: flex;
    justify-content: center;
    gap: 6px;
    margin-top: 10px;
}

.dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #666;
}

.dot.active {
    background: #fff;
}

.modal-thumbs img {
    width: 80px;
    height: 80px;
    object-fit: contain;
    cursor: pointer;
    opacity: 0.6;
    border: 2px solid transparent;
    transition: opacity 0.2s, border 0.2s;
}

.modal-thumbs img.active {
    opacity: 1;
    border-color: #fff;
}

.ui-hidden .nav-arrow,
.ui-hidden .enlarge-btn,
.ui-hidden .modal-thumbs,
.ui-hidden #fullscreenToggle,
.ui-hidden #zoomToggle,
.ui-hidden .btn-close {
    opacity: 0 !important;
    pointer-events: auto;
    transition: opacity 0.3s;
    opacity: 0.6 !important;
}

.related-item img {
    transition: transform 0.25s ease, opacity 0.25s ease;
}

.related-item:hover img {
    transform: scale(1.05);
    opacity: 0.85;
}

.related-item .title {
    font-size: 0.85rem;
    opacity: 0.85;
}

#relatedSection {
    text-align: center;
}

 /* Anti-download: Disable selection/dragging on high-res elements */
#mainImg,
#modalImage,
.modal-thumbs img {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    -webkit-user-drag: none;
    pointer-events: none; /* Blocks drags; re-enable for interactive thumbs below */
}

.modal-thumbs img {
    pointer-events: auto; /* Allows clicks on thumbs for switching images */
}
</style>


        <title>MEAN STREETS (2005) – Original British Quad Poster – Cinema Quad Posters</title>
        <meta name="description" content="British 30 x 40 inch 2005 re-release cinema quad poster for Matrin Scorcese&#039;s 1973 debut feature film Mean Streets starring Robert De Niro, Harvey Keitel and Da... Buy this collectible cinema poster.">
    
    <meta property="og:title" content="MEAN STREETS (2005) – Original British Quad Poster – Cinema Quad Posters">
    <meta property="og:description" content="British 30 x 40 inch 2005 re-release cinema quad poster for Matrin Scorcese&#039;s 1973 debut feature film Mean Streets starring Robert De Niro, Harvey Keitel and David Proval This film poster is in Near m... Buy this collectible cinema poster.">
    <meta property="og:image" content="https://www.cinemaquadposters.co.uk/posters-thumb/mean-streets-r-quad-poster.jpg">
    <meta property="og:type" content="product">
    <meta property="og:url" content="https://www.cinemaquadposters.co.uk/static-posters/mean-streets.html">
    <script>const posterData = {"title":"MEAN STREETS","variant":null,"originally released":2005,"director":"Matrin Scorcese","actors":["Robert De","Harvey Keitel","David Proval"],"genre":null,"condition":"scorcese's 1973 debut feature film mean streets starring robert de niro, harvey keitel and david proval this film poster is in Near mint rolled condition","poster_type":"quad","poster_size":"30 x 40 inches","thumbnail":"posters-thumb/mean-streets-r-quad-poster.jpg","hires":"posters/mean-streets-r-quad-poster.jpg","price":64.99,"film_summary":"British 30 x 40 inch 2005 re-release cinema quad poster for Matrin Scorcese's 1973 debut feature film Mean Streets starring Robert De Niro, Harvey Keitel and David Proval This film poster is in Near mint rolled condition with only some light edge wear and a 3cm tear on the left edge.","poster_notes":"","tags":["2005","Harvey Keitel","Matrin Scorcese","Robert De","rolled"],"gallery":["posters/mean-streets-r-quad-poster.jpg"],"sort_title":"MEAN STREETS","on_sale":false,"purchase_date":"","payment_link":"https://buy.stripe.com/test_8x28wO2DSdBYeuUg6ycjS2a","product_id":"prod_TiiOHusqbRzrzu"};</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Product","name":"MEAN STREETS","description":"British 30 x 40 inch 2005 re-release cinema quad poster for Matrin Scorcese&#039;s 1973 debut feature film Mean Streets starring Robert De Niro, Harvey Keitel and David Proval This film poster is in Near mint rolled condition with only some light edge wear and a 3cm tear on the left edge.","image":"https://www.cinemaquadposters.co.uk/posters-thumb/mean-streets-r-quad-poster.jpg","offers":{"@type":"Offer","price":64.99,"priceCurrency":"GBP","itemCondition":"https://schema.org/UsedCondition","availability":"https://schema.org/InStock"}}</script></head>

<body class="bg-black text-white">

<!-- NAVBAR -->
<nav class="navbar navbar-expand-sm bg-dark navbar-dark sticky-top px-3">
    <div class="container-fluid">
        <!-- Logo -->
        <a href="shop.html" class="me-4">
            <img src="img/logo_2023.png" alt="Cinema Quad Posters" style="height:40px;">
        </a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="shop.html">Shop</a>
            <a href="cart.html" class="nav-link cart-link">
            <i class="bi bi-cart3"></i>
            <span id="cartCount" class="cart-badge">0</span>
            </a>
        </div>
    </div>
</nav>

<div class="container py-5">
    <div id="posterContent"></div>

    <!-- You may also like -->
    <div id="relatedSection" class="mt-5"></div>
</div>


<!-- FULLSCREEN MODAL -->
<div class="modal fade" id="lightboxModal" tabindex="-1">
<div class="modal-dialog modal-fullscreen">
<div class="modal-content bg-black">
<div class="modal-body text-center">

<div class="modal-img-container">
    <img id="modalImage" class="img-fluid" style="max-height:80vh; object-fit:contain;" draggable="false" ondragstart="return false;" oncontextmenu="return false;">
</div>

<div class="d-flex justify-content-center gap-2 modal-thumbs"></div>

<div class="position-absolute top-0 end-0 m-3 d-flex gap-2">
    <!-- Zoom toggle -->
    <button class="btn btn-dark btn-sm" id="zoomToggle" title="Toggle zoom">
        <i class="bi bi-zoom-in"></i>
    </button>
    <!-- Toggle fullscreen -->
    <button class="btn btn-dark btn-sm"
            id="fullscreenToggle"
            title="Toggle fullscreen">
        <i class="bi bi-arrows-fullscreen"></i>
    </button>

    <!-- Close -->
    <button class="btn btn-dark btn-sm" data-bs-dismiss="modal" title="Close">
        <i class="bi bi-x-lg"></i>
    </button>
</div>


</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Utility to get/set cart (array of {id: string, title: string, price: number, thumbnail: string})
function getCart() {
    return JSON.parse(localStorage.getItem('cart') || '[]');
}

function setCart(cart) {
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartBadge();
}

function addToCart(item) {
    const cart = getCart();
    // Check if already in cart (simple: no quantity, assume one per item)
    if (!cart.some(c => c.id === item.id)) {
        cart.push(item);
        setCart(cart);
        alert(`${item.title} added to cart!`); // Or use a toast/modal
    } else {
        alert(`${item.title} is already in your cart.`);
    }
}

function removeFromCart(id) {
    let cart = getCart();
    cart = cart.filter(item => item.id !== id);
    setCart(cart);
}

function updateCartBadge(animate = false) {
    const badge = document.getElementById('cartCount');
    if (badge) {
        const count = getCart().length;
        badge.textContent = count;
        if (animate && count > 0) {
            badge.classList.add('animate');
            setTimeout(() => badge.classList.remove('animate'), 300);
        }
    }
}

function esc(str) {
    return (str || '').replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;')
                      .replace(/"/g, '&quot;')
                      .replace(/'/g, '&#039;');
}
let images = [];
let currentIndex = 0;
let isZoomActive = false;
let posX = 0, posY = 0;
let scale = 1;
let isDragging = false;
let lastX = 0, lastY = 0;
const modal = new bootstrap.Modal(document.getElementById('lightboxModal'));
const modalImg = document.getElementById('modalImage');
const modalImgContainer = modalImg.parentElement;
const zoomBtn = document.getElementById('zoomToggle');
const fsBtn = document.getElementById('fullscreenToggle');
const modalThumbs = document.querySelector('.modal-thumbs');

// On load, use embedded posterData
const poster = posterData; // Embedded from build.js

if (!poster || !poster.title) {
    document.getElementById('posterContent').innerHTML = '<p>Error loading poster.</p>';
    throw new Error('Poster data missing');
}

// Add JSON-LD for SEO (already embedded, but redundant here if in head—keep for completeness)
const jsonLd = {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": esc(poster.title),
    "description": esc(poster.film_summary),
    "image": poster.thumbnail,
    "offers": {
        "@type": "Offer",
        "price": poster.price,
        "priceCurrency": "GBP",
        "itemCondition": "https://schema.org/UsedCondition",
        "availability": "https://schema.org/InStock"
    }
};
const script = document.createElement('script');
script.type = 'application/ld+json';
script.text = JSON.stringify(jsonLd);
document.head.appendChild(script);

// Set dynamic title and meta for SEO (already in head via build.js, but ensure)
document.title = `${esc(poster.title)} (${poster['originally released'] || 'N/A'}) – Original British Quad Poster – Cinema Quad Posters`;
const metaDesc = document.querySelector('meta[name="description"]');
if (metaDesc) {
    metaDesc.content = esc(poster.film_summary.slice(0, 160)) + '... Buy this collectible quad poster.';
}

images = [poster.hires, ...(poster.gallery || [])];
document.getElementById('posterContent').innerHTML = `
    <div class="row">
        <div class="col-md-6 mb-4 mb-md-0">
            <div class="poster-viewer">
                <img id="mainImg" src="${images[0]}" alt="${esc(poster.title)} original British quad poster" class="img-fluid" draggable="false" ondragstart="return false;" oncontextmenu="return false;">
                ${images.length > 1 ? `
                    <button class="nav-arrow left" onclick="prevImage()"><i class="bi bi-chevron-left"></i></button>
                    <button class="nav-arrow right" onclick="nextImage()"><i class="bi bi-chevron-right"></i></button>
                ` : ''}
                <button class="enlarge-btn" onclick="openLightbox(0)"><i class="bi bi-arrows-angle-expand"></i></button>
            </div>
            ${images.length > 1 ? `
                <div class="dot-indicators">
                    ${images.map((_, i) => `<div class="dot ${i === 0 ? 'active' : ''}" onclick="selectImage(${i})"></div>`).join('')}
                </div>
            ` : ''}
        </div>
        <div class="col-md-6">
            <h1 class="mb-3">${esc(poster.title)}</h1>
            <p class="text-muted mb-4">${poster['originally released'] ? `Originally released: ${poster['originally released']}` : ''}${poster.variant ? ` (${esc(poster.variant)})` : ''}</p>
            <p>${esc(poster.film_summary)}</p>
            <ul class="poster-specs mb-4">
                <li><strong>Director:</strong> ${esc(poster.director || 'N/A')}</li>
                <li><strong>Actors:</strong> ${poster.actors ? poster.actors.map(esc).join(', ') : 'N/A'}</li>
                <li><strong>Genre:</strong> ${poster.genre ? (Array.isArray(poster.genre) ? poster.genre.join(', ') : poster.genre) : 'N/A'}</li>
                <li><strong>Condition:</strong> ${esc(poster.condition || 'N/A')}</li>
                <li><strong>Size:</strong> ${esc(poster.poster_size || '30 x 40 inches')}</li>
            </ul>
            <p class="mb-4">${esc(poster.poster_notes || '')}</p>
            <div class="d-flex align-items-center mb-4">
                <span class="price fw-bold fs-4">£${poster.price.toFixed(2)}</span>
                ${poster.on_sale ? '<span class="sale-info">SALE</span>' : ''}
            </div>
            <button id="addToCart" class="btn btn-warning text-dark fw-bold">Add to Cart £${poster.price.toFixed(2)}</button>
        </div>
    </div>
`;

// Normalize genres for related (stub for now)
const posterGenres = Array.isArray(poster.genre) ? poster.genre : (poster.genre ? [poster.genre] : []);
// Related posters - Stub as [] (pre-compute in future if wanted)
const related = []; // Adjust in build.js to embed 4 related items based on genre/tags
if (related.length) {
    const slugs = related.map(x => {
        return x.title.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-').replace(/^-+|-+$/g, '');
    });
    document.getElementById('relatedSection').innerHTML = `
        <h5 class="mb-3">You may also like</h5>
        <div class="row g-3">
            ${related.map((x, idx) => `
                <div class="col-6 col-md-3">
                    <a href="static-posters/${slugs[idx]}.html" class="related-item">
                        <img src="${x.thumbnail}" alt="${esc(x.title)}" class="img-fluid mb-1">
                        <div class="title text-muted small">${esc(x.title)}</div>
                    </a>
                </div>
            `).join('')}
        </div>
    `;
} else {
    document.getElementById('relatedSection').style.display = 'none';
}

// Setup addToCart listener
document.getElementById('addToCart').addEventListener('click', () => {
    addToCart({
        id: poster.product_id, // Use Stripe product_id as unique key
        title: poster.title,
        price: poster.price,
        thumbnail: poster.thumbnail
    });
    updateCartBadge(true); // Animate
});

// SLIDESHOW FUNCTIONS
function prevImage() {
currentIndex = (currentIndex - 1 + images.length) % images.length;
document.getElementById('mainImg').src = images[currentIndex];
updateDots();
}
function nextImage() {
currentIndex = (currentIndex + 1) % images.length;
document.getElementById('mainImg').src = images[currentIndex];
updateDots();
}
function selectImage(i) {
currentIndex = i;
document.getElementById('mainImg').src = images[currentIndex];
updateDots();
}
function updateDots() {
const dots = document.querySelectorAll('.dot');
dots.forEach((dot, i) => dot.classList.toggle('active', i === currentIndex));
}
function openLightbox(i) {
currentIndex = i;
modalImg.src = images[currentIndex];
modalThumbs.innerHTML = images.map((img, j) => `
        <img src="${img}" class="${j === currentIndex ? 'active' : ''}" onclick="selectModalImage(${j})">
    `).join('');
resetZoom();
modal.show();
}
function selectModalImage(i) {
currentIndex = i;
modalImg.src = images[currentIndex];
const thumbs = modalThumbs.querySelectorAll('img');
thumbs.forEach((thumb, j) => thumb.classList.toggle('active', j === i));
resetZoom();
}
// Attach zoom/pan events on modal show (fixes not functioning)
modal._element.addEventListener('shown.bs.modal', () => {
zoomBtn.addEventListener('click', toggleZoom);
modalImgContainer.addEventListener('mousedown', startDrag);
modalImgContainer.addEventListener('mousemove', drag);
modalImgContainer.addEventListener('mouseup', endDrag);
modalImgContainer.addEventListener('mouseleave', endDrag);
modalImgContainer.addEventListener('wheel', wheelZoom);
});
/* =====================================================
   ZOOM / PAN FUNCTIONS
===================================================== */
zoomBtn.addEventListener('click', () => {
isZoomActive ? disableZoom() : enableZoom();
});
function enableZoom() {
isZoomActive = true;
scale = 2;
posX = 0;
posY = 0;
modalImgContainer.classList.add('zoom-active');
modalImg.classList.add('zoom-active');
updateTransform();
zoomBtn.innerHTML = '<i class="bi bi-zoom-out"></i>';
}
function disableZoom() {
isZoomActive = false;
scale = 1;
posX = 0;
posY = 0;
modalImgContainer.classList.remove('zoom-active');
modalImg.classList.remove('zoom-active');
updateTransform();
zoomBtn.innerHTML = '<i class="bi bi-zoom-in"></i>';
}
function resetZoom() {
disableZoom();
}
function updateTransform() {
modalImg.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
}
/* =====================================================
   DRAG TO PAN
===================================================== */
modalImgContainer.addEventListener('pointerdown', e => {
if (!isZoomActive) return;
modalImgContainer.setPointerCapture(e.pointerId);
isDragging = true;
lastX = e.clientX - posX;
lastY = e.clientY - posY;
modalImgContainer.style.cursor = 'grabbing';
});
modalImgContainer.addEventListener('pointermove', e => {
if (!isDragging) return;
posX = e.clientX - lastX;
posY = e.clientY - lastY;
clampPosition();
updateTransform();
});
modalImgContainer.addEventListener('pointerup', () => {
isDragging = false;
modalImgContainer.style.cursor = isZoomActive ? 'grab' : 'default';
});
modalImgContainer.addEventListener('pointerleave', () => {
isDragging = false;
});
/* =====================================================
   CLAMP IMAGE TO CONTAINER
===================================================== */
function clampPosition() {
const imgRect = modalImg.getBoundingClientRect();
const boxRect = modalImgContainer.getBoundingClientRect();
const maxX = Math.max(0, (imgRect.width - boxRect.width) / 2);
const maxY = Math.max(0, (imgRect.height - boxRect.height) / 2);
posX = Math.max(-maxX, Math.min(maxX, posX));
posY = Math.max(-maxY, Math.min(maxY, posY));
}
/* =====================================================
   FULLSCREEN TOGGLE
===================================================== */
fsBtn.addEventListener('click', () => {
document.fullscreenElement ? document.exitFullscreen() : document.documentElement.requestFullscreen();
});
/* =====================================================
   CLEANUP ON MODAL CLOSE
===================================================== */
modal._element.addEventListener('hidden.bs.modal', resetZoom);

// Anti-download protections: Prevent right-click/drag on viewer images
document.addEventListener('contextmenu', e => {
    if (e.target.tagName === 'IMG' && (e.target.id === 'mainImg' || e.target.id === 'modalImage' || e.target.classList.contains('modal-thumb'))) {
        e.preventDefault(); // Blocks context menu (right-click "Save Image")
    }
});

const protectedImages = document.querySelectorAll('#mainImg, #modalImage, .modal-thumbs img');
protectedImages.forEach(img => {
    img.draggable = false;
    img.addEventListener('dragstart', e => e.preventDefault()); // Blocks drag-to-save
});

</script>


<!-- FOOTER -->
<footer class="site-footer mt-5">
    <div class="container py-4">
        <div class="row gy-3 align-items-center">

            <div class="col-md-4 footer-left">
                <a href="shop.html">
                    <img src="img/logo.png"
                         alt="Cinema Quad Posters"
                         class="footer-logo">
                </a>
            </div>

            <div class="col-md-4 text-center">
                <ul class="footer-links justify-content-center mb-1">
                    <li><a href="shop.html">Shop</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="faq.html">FAQs</a></li>
                    <li><a href="terms.html">Terms</a></li>
                </ul>
                <p class="small mb-0" style="color: #aaa;">    
                    © <span id="year"></span> Cinema Quad Posters
                </p>
            </div>

        </div>
    </div>
</footer>


<script>
document.getElementById('year').textContent = new Date().getFullYear();
</script>

<script src="cqp.js"></script>

<script>
// LocalStorage cart add (simple array, no Snipcart)
const addToCartBtn = document.getElementById('addToCart');
addToCartBtn.addEventListener('click', () => {
    addToCart({ id: posterData.product_id, title: posterData.title, price: posterData.price, thumbnail: posterData.thumbnail });
});
updateCartBadge(); // Initial load
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Poster – Cinema Quad Posters</title>

<meta name="description" content="Original British quad posters for classic films.">
<!-- We'll make this dynamic in JS -->

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="cqp.css">
<link rel="preload" href="inventory.json" as="fetch" crossorigin>

<style>
.poster-viewer {
    position: relative;
    display: inline-block;
}

.poster-viewer:hover .nav-arrow,
.poster-viewer:hover .enlarge-btn {
    opacity: 1;
}

.nav-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 2rem;
    background: rgba(0,0,0,0.6);
    color: #fff;
    border: none;
    padding: 6px 10px;
    opacity: 0;
    transition: opacity 0.2s;
}

.nav-arrow.left { left: 10px; }
.nav-arrow.right { right: 10px; }

.enlarge-btn {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0,0,0,0.6);
    border: none;
    color: #fff;
    font-size: 1.2rem;
    padding: 6px 8px;
    opacity: 0;
    transition: opacity 0.2s;
    cursor: pointer;
}

.dot-indicators {
    display: flex;
    justify-content: center;
    gap: 6px;
    margin-top: 10px;
}

.dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #666;
}

.dot.active {
    background: #fff;
}

.modal-thumbs img {
    width: 80px;
    height: 80px;
    object-fit: contain;
    cursor: pointer;
    opacity: 0.6;
    border: 2px solid transparent;
    transition: opacity 0.2s, border 0.2s;
}

.modal-thumbs img.active {
    opacity: 1;
    border-color: #fff;
}

.ui-hidden .nav-arrow,
.ui-hidden .enlarge-btn,
.ui-hidden .modal-thumbs,
.ui-hidden #fullscreenToggle,
.ui-hidden #zoomToggle,
.ui-hidden .btn-close {
    opacity: 0 !important;
    pointer-events: auto;
    transition: opacity 0.3s;
    opacity: 0.6 !important;
}

.related-item img {
    transition: transform 0.25s ease, opacity 0.25s ease;
}

.related-item:hover img {
    transform: scale(1.05);
    opacity: 0.85;
}

.related-item .title {
    font-size: 0.85rem;
    opacity: 0.85;
}

#relatedSection {
    text-align: center;
}

.modal-img-container {
    position: relative;
    overflow: hidden;
    display: inline-block;
    max-height: 80vh;
    width: auto;
    cursor: default;
}

#modalImage.zoom-active {
    cursor: grab;
    transition: transform 0.1s ease-out;
}

#modalImage.zoom-active:active {
    cursor: grabbing;
}

#modalImage {
    user-select: none;
    -webkit-user-drag: none;
    -webkit-user-select: none;
    pointer-events: none;
}
</style>


        <title>$ {esc(p.title)} ( $2001) – Original British Quad Poster – Cinema Quad Posters</title>
        <meta name="description" content="Alejandro Gonzalez Inarritu&#039;s brilliant 2001 drama Amores Perros, interwines three stories around a single car crash, starring Emilio Echevarria, Gael Garcia Be... Buy this collectible cinema poster.">
    <script>const posterData = {"title":"AMORES PERROS","variant":null,"originally released":2001,"director":"Alejandro Gonzalez Inarritu","actors":["Emilio Echevarria","Gael Garcia Bernal","Goya Toledo"],"genre":["drama","thriller"],"condition":"Near mint rolled","poster_type":"quad","poster_size":"30 x 40 inch","thumbnail":"posters-thumb/amores-perros-quad-poster.jpg","hires":"posters/amores-perros-quad-poster.jpg","price":27.99,"film_summary":"Alejandro Gonzalez Inarritu's brilliant 2001 drama Amores Perros, interwines three stories around a single car crash, starring Emilio Echevarria, Gael Garcia Bernal and Goya Toledo.","poster_notes":"This film poster has some minor edge wear.","tags":["2001","Unknown","Emilio Echevarria","Gael Garcia Bernal","Goya Toledo","Alejandro Gonzalez Inarritu","near","mint","rolled"],"gallery":["posters/amores-perros-quad-poster.jpg"],"sort_title":"AMORES PERROS","on_sale":true,"purchase_date":"","payment_link":"https://buy.stripe.com/test_fZu14mbaoeG286w07AcjS04","product_id":"prod_TiiMeLjj4EotMX"};</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Product","name":"AMORES PERROS","description":"Alejandro Gonzalez Inarritu&#039;s brilliant 2001 drama Amores Perros, interwines three stories around a single car crash, starring Emilio Echevarria, Gael Garcia Bernal and Goya Toledo.","image":"posters-thumb/amores-perros-quad-poster.jpg","offers":{"@type":"Offer","price":27.99,"priceCurrency":"GBP","itemCondition":"https://schema.org/UsedCondition","availability":"https://schema.org/InStock"}}</script></head>

<body class="bg-black text-white">

<!-- NAVBAR -->
<nav class="navbar navbar-expand-sm bg-dark navbar-dark sticky-top px-3">
    <div class="container-fluid">
        <!-- Logo -->
        <a href="shop.html" class="me-4">
            <img src="img/logo_2023.png" alt="Cinema Quad Posters" style="height:40px;">
        </a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="shop.html">Shop</a>
            <a class="navbar-link active" href="shop.html">Shop</a>
            <a class="nav-link cart-link" href="cart.html">
            <i class="bi bi-cart3"></i>
            <span id="cartCount" class="cart-badge">0</span>
            </a>
        </div>
    </div>
</nav>

<div class="container py-5">
    <div id="posterContent"></div>

    <!-- You may also like -->
    <div id="relatedSection" class="mt-5"></div>
</div>


<!-- FULLSCREEN MODAL -->
<div class="modal fade" id="lightboxModal" tabindex="-1">
<div class="modal-dialog modal-fullscreen">
<div class="modal-content bg-black">
<div class="modal-body text-center">

<div class="modal-img-container">
    <img id="modalImage" class="img-fluid" style="max-height:80vh; object-fit:contain;" draggable="false" ondragstart="return false;" oncontextmenu="return false;">
</div>

<div class="d-flex justify-content-center gap-2 modal-thumbs"></div>

<div class="position-absolute top-0 end-0 m-3 d-flex gap-2">
    <!-- Zoom toggle -->
    <button class="btn btn-dark btn-sm" id="zoomToggle" title="Toggle zoom">
        <i class="bi bi-zoom-in"></i>
    </button>
    <!-- Toggle fullscreen -->
    <button class="btn btn-dark btn-sm"
            id="fullscreenToggle"
            title="Toggle fullscreen">
        <i class="bi bi-arrows-fullscreen"></i>
    </button>

    <!-- Close -->
    <button class="btn btn-dark btn-sm" data-bs-dismiss="modal" title="Close">
        <i class="bi bi-x-lg"></i>
    </button>
</div>


</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Utility to get/set cart (array of {id: string, title: string, price: number, thumbnail: string})
function getCart() {
    return JSON.parse(localStorage.getItem('cart') || '[]');
}

function setCart(cart) {
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartBadge();
}

function addToCart(item) {
    const cart = getCart();
    // Check if already in cart (simple: no quantity, assume one per item)
    if (!cart.some(c => c.id === item.id)) {
        cart.push(item);
        setCart(cart);
        alert(`${item.title} added to cart!`); // Or use a toast/modal
    } else {
        alert(`${item.title} is already in your cart.`);
    }
}

function removeFromCart(id) {
    let cart = getCart();
    cart = cart.filter(item => item.id !== id);
    setCart(cart);
}

function updateCartBadge(animate = false) {
    const badge = document.getElementById('cartCount');
    if (badge) {
        const count = getCart().length;
        badge.textContent = count;
        if (animate && count > 0) {
            badge.classList.add('animate');
            setTimeout(() => badge.classList.remove('animate'), 300);
        }
    }
}

function esc(str) {
    return (str || '').replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;')
                      .replace(/"/g, '&quot;')
                      .replace(/'/g, '&#039;');
}
let images = [];
let currentIndex = 0;
let isZoomActive = false;
let posX = 0, posY = 0;
let scale = 1;
let isDragging = false;
let lastX = 0, lastY = 0;
const modal = new bootstrap.Modal(document.getElementById('lightboxModal'));
const modalImg = document.getElementById('modalImage');
const modalImgContainer = modalImg.parentElement;
const zoomBtn = document.getElementById('zoomToggle');
const fsBtn = document.getElementById('fullscreenToggle');
const modalThumbs = document.querySelector('.modal-thumbs');
window.addEventListener('load', () => {
const params = new URLSearchParams(location.search);
const id = decodeURIComponent(params.get('id') || '');
fetch('inventory.json')
        .then(r => r.json())
        .then(data => {
const poster = data.find(p => p.thumbnail === id);
if (!poster) {
document.getElementById('posterContent').innerHTML = '<p>Poster not found.</p>';
return;
            }
// Add JSON-LD for SEO
const jsonLd = {
"@context": "https://schema.org",
"@type": "Product",
"name": esc(poster.title),
"description": esc(poster.film_summary),
"image": poster.thumbnail,
"offers": {
"@type": "Offer",
"price": poster.price,
"priceCurrency": "GBP",
"itemCondition": "https://schema.org/UsedCondition",
"availability": "https://schema.org/InStock"
                }
            };
const script = document.createElement('script');
script.type = 'application/ld+json';
script.text = JSON.stringify(jsonLd);
document.head.appendChild(script);
// Set dynamic title and meta for SEO
document.title = `${esc(poster.title)} (${poster['originally released'] || 'N/A'}) – Original British Quad Poster – Cinema Quad Posters`;
const metaDesc = document.querySelector('meta[name="description"]');
if (metaDesc) {
metaDesc.content = esc(poster.film_summary.slice(0, 160)) + '... Buy this collectible quad poster.';
            }
images = [poster.hires, ...(poster.gallery || [])];
document.getElementById('posterContent').innerHTML = `
                <div class="row">
                    <div class="col-md-6 mb-4 mb-md-0">
                        <div class="poster-viewer">
                            <img id="mainImg" src="${images[0]}" alt="${esc(poster.title)} original British quad poster" class="img-fluid" draggable="false" ondragstart="return false;" oncontextmenu="return false;">
${images.length > 1 ? `
                                <button class="nav-arrow left" onclick="prevImage()"><i class="bi bi-chevron-left"></i></button>
                                <button class="nav-arrow right" onclick="nextImage()"><i class="bi bi-chevron-right"></i></button>
                            ` : ''}
                            <button class="enlarge-btn" onclick="openLightbox(0)"><i class="bi bi-arrows-angle-expand"></i></button>
                        </div>
${images.length > 1 ? `
                            <div class="dot-indicators">
${images.map((_, i) => `<div class="dot ${i === 0 ? 'active' : ''}" onclick="selectImage(${i})"></div>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                    <div class="col-md-6">
                        <h1 class="mb-3">${esc(poster.title)}</h1>
                        <p class="text-muted mb-4">${poster['originally released'] ? `Originally released: ${poster['originally released']}` : ''}${poster.variant ? ` (${esc(poster.variant)})` : ''}</p>
                        <p>${esc(poster.film_summary)}</p>
                        <ul class="poster-specs mb-4">
                            <li><strong>Director:</strong> ${esc(poster.director || 'N/A')}</li>
                            <li><strong>Actors:</strong> ${poster.actors ? poster.actors.map(esc).join(', ') : 'N/A'}</li>
                            <li><strong>Genre:</strong> ${poster.genre ? (Array.isArray(poster.genre) ? poster.genre.join(', ') : poster.genre) : 'N/A'}</li>
                            <li><strong>Condition:</strong> ${esc(poster.condition || 'N/A')}</li>
                            <li><strong>Size:</strong> ${esc(poster.poster_size || '30 x 40 inches')}</li>
                        </ul>
                        <p class="mb-4">${esc(poster.poster_notes || '')}</p>
                        <div class="d-flex align-items-center mb-4">
                            <span class="price fw-bold fs-4">£${poster.price.toFixed(2)}</span>
${poster.on_sale ? '<span class="sale-info">SALE</span>' : ''}
                        </div>
                        <button id="addToCartBtn" class="btn btn-warning text-dark fw-bold">Add to Cart £${poster.price.toFixed(2)}</button>
                    </div>
                </div>
            `;
// Normalize genres for related (stub for now)
const posterGenres = Array.isArray(poster.genre) ? poster.genre : (poster.genre ? [poster.genre] : []);
// Related posters - Stub as [] (pre-compute in future if wanted)
const related = []; // Adjust in build.js to embed 4 related items based on genre/tags
if (related.length) {
document.getElementById('relatedSection').innerHTML = `
                    <h5 class="mb-3">You may also like</h5>
                    <div class="row g-3">
${related.map(x => `
                            <div class="col-6 col-md-3">
                                <a href="poster.html?id=${encodeURIComponent(x.thumbnail)}" class="related-item">
                                    <img src="${x.thumbnail}" alt="${esc(x.title)}" class="img-fluid mb-1">
                                    <div class="title text-muted small">${esc(x.title)}</div>
                                </a>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        document.getElementById('addToCartBtn').addEventListener('click', () => {
            addToCart({
                id: poster.product_id, // Use Stripe product_id as unique key
                title: poster.title,
                price: poster.price,
                thumbnail: poster.thumbnail
            });
            updateCartBadge(true); // Animate
        });
        })
        .catch(error => {
console.error('Error:', error);
document.getElementById('posterContent').innerHTML = '<p>Error loading poster.</p>';
        });
});
// SLIDESHOW FUNCTIONS
function prevImage() {
currentIndex = (currentIndex - 1 + images.length) % images.length;
document.getElementById('mainImg').src = images[currentIndex];
updateDots();
}
function nextImage() {
currentIndex = (currentIndex + 1) % images.length;
document.getElementById('mainImg').src = images[currentIndex];
updateDots();
}
function selectImage(i) {
currentIndex = i;
document.getElementById('mainImg').src = images[currentIndex];
updateDots();
}
function updateDots() {
const dots = document.querySelectorAll('.dot');
dots.forEach((dot, i) => dot.classList.toggle('active', i === currentIndex));
}
function openLightbox(i) {
currentIndex = i;
modalImg.src = images[currentIndex];
modalThumbs.innerHTML = images.map((img, j) => `
        <img src="${img}" class="${j === currentIndex ? 'active' : ''}" onclick="selectModalImage(${j})">
    `).join('');
resetZoom();
modal.show();
}
function selectModalImage(i) {
currentIndex = i;
modalImg.src = images[currentIndex];
const thumbs = modalThumbs.querySelectorAll('img');
thumbs.forEach((thumb, j) => thumb.classList.toggle('active', j === i));
resetZoom();
}
// Attach zoom/pan events on modal show (fixes not functioning)
modal._element.addEventListener('shown.bs.modal', () => {
zoomBtn.addEventListener('click', toggleZoom);
modalImgContainer.addEventListener('mousedown', startDrag);
modalImgContainer.addEventListener('mousemove', drag);
modalImgContainer.addEventListener('mouseup', endDrag);
modalImgContainer.addEventListener('mouseleave', endDrag);
modalImgContainer.addEventListener('wheel', wheelZoom);
});
/* =====================================================
   ZOOM / PAN FUNCTIONS
===================================================== */
zoomBtn.addEventListener('click', () => {
isZoomActive ? disableZoom() : enableZoom();
});
function enableZoom() {
isZoomActive = true;
scale = 2;
posX = 0;
posY = 0;
modalImgContainer.classList.add('zoom-active');
modalImg.classList.add('zoom-active');
updateTransform();
zoomBtn.innerHTML = '<i class="bi bi-zoom-out"></i>';
}
function disableZoom() {
isZoomActive = false;
scale = 1;
posX = 0;
posY = 0;
modalImgContainer.classList.remove('zoom-active');
modalImg.classList.remove('zoom-active');
updateTransform();
zoomBtn.innerHTML = '<i class="bi bi-zoom-in"></i>';
}
function resetZoom() {
disableZoom();
}
function updateTransform() {
modalImg.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
}
/* =====================================================
   DRAG TO PAN
===================================================== */
modalImgContainer.addEventListener('pointerdown', e => {
if (!isZoomActive) return;
modalImgContainer.setPointerCapture(e.pointerId);
isDragging = true;
lastX = e.clientX - posX;
lastY = e.clientY - posY;
modalImgContainer.style.cursor = 'grabbing';
});
modalImgContainer.addEventListener('pointermove', e => {
if (!isDragging) return;
posX = e.clientX - lastX;
posY = e.clientY - lastY;
clampPosition();
updateTransform();
});
modalImgContainer.addEventListener('pointerup', () => {
isDragging = false;
modalImgContainer.style.cursor = isZoomActive ? 'grab' : 'default';
});
modalImgContainer.addEventListener('pointerleave', () => {
isDragging = false;
});
/* =====================================================
   CLAMP IMAGE TO CONTAINER
===================================================== */
function clampPosition() {
const imgRect = modalImg.getBoundingClientRect();
const boxRect = modalImgContainer.getBoundingClientRect();
const maxX = Math.max(0, (imgRect.width - boxRect.width) / 2);
const maxY = Math.max(0, (imgRect.height - boxRect.height) / 2);
posX = Math.max(-maxX, Math.min(maxX, posX));
posY = Math.max(-maxY, Math.min(maxY, posY));
}
/* =====================================================
   FULLSCREEN TOGGLE
===================================================== */
fsBtn.addEventListener('click', () => {
document.fullscreenElement ? document.exitFullscreen() : document.documentElement.requestFullscreen();
});
/* =====================================================
   CLEANUP ON MODAL CLOSE
===================================================== */
modal._element.addEventListener('hidden.bs.modal', resetZoom);

</script>


<!-- FOOTER -->
<footer class="site-footer mt-5">
    <div class="container py-4">
        <div class="row gy-3 align-items-center">

            <div class="col-md-4 footer-left">
                <a href="shop.html">
                    <img src="img/logo.png"
                         alt="Cinema Quad Posters"
                         class="footer-logo">
                </a>
            </div>

            <div class="col-md-4 text-center">
                <ul class="footer-links justify-content-center mb-1">
                    <li><a href="shop.html">Shop</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="faq.html">FAQs</a></li>
                    <li><a href="terms.html">Terms</a></li>
                </ul>
                <p class="small mb-0" style="color: #aaa;">    
                    © <span id="year"></span> Cinema Quad Posters
                </p>
            </div>

        </div>
    </div>
</footer>


<script>
document.getElementById('year').textContent = new Date().getFullYear();
</script>

<script src="cqp.js"></script>

</body>
</html>
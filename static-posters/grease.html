<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Poster – Cinema Quad Posters</title> <!-- Placeholder: build.js will replace this with e.g., "ABBA - THE MOVIE (1977) – Original British Quad Poster – Cinema Quad Posters" -->
<meta name="description" content="Original British quad posters for classic films."> <!-- Placeholder: build.js will replace with poster-specific summary -->

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="/cqp.css">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DCT6EGE8PB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DCT6EGE8PB');
</script>

<style>
.poster-viewer {
    position: relative;
    display: inline-block;
    cursor: pointer;
}

.poster-viewer:hover .nav-arrow,
.poster-viewer:hover .enlarge-btn {
    opacity: 1;
}

.nav-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 2rem;
    background: rgba(0,0,0,0.6);
    color: #fff;
    border: none;
    padding: 6px 10px;
    opacity: 0;
    transition: opacity 0.2s;
}

.nav-arrow.left { left: 10px; }
.nav-arrow.right { right: 10px; }

.enlarge-btn {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0,0,0,0.6);
    border: none;
    color: #fff;
    font-size: 1.2rem;
    padding: 6px 8px;
    opacity: 0;
    transition: opacity 0.2s;
    cursor: pointer;
}

.dot-indicators {
    display: flex;
    justify-content: center;
    gap: 6px;
    margin-top: 10px;
}

.dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #666;
}

.dot.active {
    background: #fff;
}

.modal-thumbs img {
    width: 80px;
    height: 80px;
    object-fit: contain;
    cursor: pointer;
    opacity: 0.6;
    border: 2px solid transparent;
    transition: opacity 0.2s, border 0.2s;
}

.modal-thumbs img.active {
    opacity: 1;
    border-color: #fff;
}

.ui-hidden .nav-arrow,
.ui-hidden .enlarge-btn,
.ui-hidden .modal-thumbs,
.ui-hidden #fullscreenToggle,
.ui-hidden #zoomToggle,
.ui-hidden .btn-close {
    opacity: 0 !important;
    pointer-events: auto;
    transition: opacity 0.3s;
    opacity: 0.6 !important;
}

.related-item img {
    transition: transform 0.25s ease, opacity 0.25s ease;
}

.related-item:hover img {
    transform: scale(1.05);
    opacity: 0.85;
}

.related-item .title {
    font-size: 0.85rem;
    opacity: 0.85;
}

#relatedSection {
    text-align: center;
}

/* Anti-download: Disable selection/dragging on high-res elements */
#mainImg,
#modalImage,
.modal-thumbs img {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    -webkit-user-drag: none;
    pointer-events: none;
}

.modal-thumbs img {
    pointer-events: auto;
}

#addToCart:active {
    background-color: #e0a800; /* Darker yellow on press */
    transform: scale(0.98); /* Slight shrink for click feel */
    transition: transform 0.1s ease;
}

.category-label {
    color: #aaa; /* Light grey like footer */
    font-weight: bold;
}
.category-value {
    color: #fff; /* White for values */
}
</style>


        <title>GREASE (2018) – Original British Quad Poster – Cinema Quad Posters</title>
        <meta name="description" content="British 30 x 40 inch 2018 40th anniversary re-release quad poster for the 1978 Oscar nominated musical classic Grease, starring John Travolta &amp; Olivia Newton-Jo... Buy this collectible cinema poster.">
    
    <meta property="og:title" content="GREASE (2018) – Original British Quad Poster – Cinema Quad Posters">
    <meta property="og:description" content="British 30 x 40 inch 2018 40th anniversary re-release quad poster for the 1978 Oscar nominated musical classic Grease, starring John Travolta &amp; Olivia Newton-John.This poster is in Near mint rolled co... Buy this collectible cinema poster.">
    <meta property="og:image" content="https://www.cinemaquadposters.co.uk/posters-thumb/grease-40th-quad-poster.jpg">
    <meta property="og:type" content="product">
    <meta property="og:url" content="https://www.cinemaquadposters.co.uk/static-posters/grease.html">
    <script>const posterData = {"title":"GREASE","variant":null,"originally released":2018,"director":null,"actors":["John Travolta","Olivia Newton"],"genre":"music, musical","condition":"Near mint rolled condition","poster_type":"quad","poster_size":"30 x 40 inches","thumbnail":"posters-thumb/grease-40th-quad-poster.jpg","hires":"posters/grease-40th-quad-poster.jpg","price":54.99,"film_summary":"British 30 x 40 inch 2018 40th anniversary re-release quad poster for the 1978 Oscar nominated musical classic Grease, starring John Travolta & Olivia Newton-John.This poster is in Near mint rolled condition.","poster_notes":"","tags":["16.00","rolled"],"gallery":["posters/grease-40th-quad-poster.jpg"],"sort_title":"GREASE","on_sale":false,"purchase_date":"2018-08-21","payment_link":"https://buy.stripe.com/test_7sY8wObaoapM72s7A2cjS1w","product_id":"prod_TiiNpQGaeic8dt"};</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Product","name":"GREASE","description":"British 30 x 40 inch 2018 40th anniversary re-release quad poster for the 1978 Oscar nominated musical classic Grease, starring John Travolta &amp; Olivia Newton-John.This poster is in Near mint rolled condition.","image":"https://www.cinemaquadposters.co.uk/posters-thumb/grease-40th-quad-poster.jpg","offers":{"@type":"Offer","price":54.99,"priceCurrency":"GBP","itemCondition":"https://schema.org/UsedCondition","availability":"https://schema.org/InStock"}}</script></head>

<body class="bg-black text-white">

<!-- NAVBAR -->
<nav class="navbar navbar-expand-sm bg-dark navbar-dark sticky-top px-3">
    <div class="container-fluid">
        <a href="/shop.html" class="me-4">
            <img src="/img/logo_2023.png" alt="Cinema Quad Posters" style="height:40px;">
        </a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/shop.html">Shop</a>
            <a href="/cart.html" class="nav-link cart-link">
                <i class="bi bi-cart3"></i>
                <span id="cartCount" class="cart-badge">0</span>
            </a>
        </div>
    </div>
</nav>

<div class="container py-5">
    <div id="posterContent"></div>

    <!-- You may also like -->
    <div id="relatedSection" class="mt-5"></div>
</div>

<!-- FULLSCREEN MODAL -->
<div class="modal fade" id="lightboxModal" tabindex="-1">
<div class="modal-dialog modal-fullscreen">
<div class="modal-content bg-black">
<div class="modal-body text-center">

<div class="modal-img-container">
    <img id="modalImage" class="img-fluid" style="max-height:80vh; object-fit:contain;" draggable="false" ondragstart="return false;" oncontextmenu="return false;">
</div>

<div class="d-flex justify-content-center gap-2 modal-thumbs"></div>

<div class="position-absolute top-0 end-0 m-3 d-flex gap-2">
    <button class="btn btn-dark btn-sm" id="zoomToggle" title="Toggle zoom">
        <i class="bi bi-zoom-in"></i>
    </button>
    <button class="btn btn-dark btn-sm" id="fullscreenToggle" title="Toggle fullscreen">
        <i class="bi bi-arrows-fullscreen"></i>
    </button>
    <button class="btn btn-dark btn-sm" data-bs-dismiss="modal" title="Close">
        <i class="bi bi-x-lg"></i>
    </button>
</div>

</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Embedded poster data from build.js
const poster = posterData;

let images = [];
let currentIndex = 0;
let isZoomActive = false;
let posX = 0, posY = 0;
let scale = 1;
let isDragging = false;
let lastX = 0, lastY = 0;

const modal = new bootstrap.Modal(document.getElementById('lightboxModal'));
const modalImg = document.getElementById('modalImage');
const modalImgContainer = modalImg.parentElement;
const zoomBtn = document.getElementById('zoomToggle');
const fsBtn = document.getElementById('fullscreenToggle');
const modalThumbs = document.querySelector('.modal-thumbs');

function esc(str) {
    return (str || '').replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;')
                      .replace(/"/g, '&quot;')
                      .replace(/'/g, '&#039;');
}

// Render main poster content
images = [poster.hires, ...(poster.gallery || [])];

document.getElementById('posterContent').innerHTML = `
    <div class="row">
        <div class="col-md-6 mb-4 mb-md-0">
            <div class="poster-viewer">
                <img id="mainImg" src="/${images[0]}" alt="${esc(poster.title)} original British quad poster" class="img-fluid" draggable="false" ondragstart="return false;" oncontextmenu="return false;">
                ${images.length > 1 ? `
                    <button class="nav-arrow left" onclick="prevImage()"><i class="bi bi-chevron-left"></i></button>
                    <button class="nav-arrow right" onclick="nextImage()"><i class="bi bi-chevron-right"></i></button>
                ` : ''}
                <button class="enlarge-btn" onclick="openLightbox(currentIndex)"><i class="bi bi-arrows-angle-expand"></i></button>
            </div>
            ${images.length > 1 ? `
                <div class="dot-indicators">
                    ${images.map((_, i) => `<div class="dot ${i === 0 ? 'active' : ''}" onclick="selectImage(${i})"></div>`).join('')}
                </div>
            ` : ''}
        </div>
        <div class="col-md-6">
            <h1 class="mb-3">${esc(poster.title)}</h1>
            <p class="text-muted mb-1"><span class="category-label">Originally released:</span> <span class="category-value">${poster['originally released'] || 'N/A'}</span></p>
        ${poster.variant ? `<p class="text-muted mb-1"><span class="category-label">Variant:</span> <span class="category-value">${esc(poster.variant)}</span></p>` : ''}
            <p class="text-muted mb-1"><span class="category-label">Condition:</span> <span class="category-value">${esc(poster.condition || 'N/A')}</span></p>
            <p class="text-muted mb-4"><span class="category-label">Genre:</span> <span class="category-value">${Array.isArray(poster.genre) ? poster.genre.join(', ') : (poster.genre || 'N/A')}</span></p>
            <p class="mb-4">${esc(poster.film_summary)}</p>
            <p class="mb-4">${esc(poster.poster_notes || '')}</p>
            <div class="d-flex align-items-center mb-4">
                <span class="price fw-bold fs-4">£${poster.price.toFixed(2)}</span>
        ${poster.on_sale ? '<span class="sale-info">SALE</span>' : ''}
            </div>
            <button id="addToCart" class="btn btn-warning text-dark fw-bold">Add to Cart</button>
        </div>
`;

// Click anywhere on the main image (or enlarge button) opens the modal at current index
document.getElementById('mainImg').addEventListener('click', () => openLightbox(currentIndex));

// Related posters – fixed genre handling
fetch('/inventory.json')
    .then(r => r.json())
    .then(data => {
        const posterGenres = Array.isArray(poster.genre) ? poster.genre.map(g => g.toLowerCase()) : 
                             (poster.genre ? [poster.genre.toLowerCase()] : []);
        
        const related = data.filter(p => {
            const pGenres = Array.isArray(p.genre) ? p.genre.map(g => g.toLowerCase()) : 
                            (p.genre ? [p.genre.toLowerCase()] : []);
            return pGenres.some(g => posterGenres.includes(g)) && p.product_id !== poster.product_id;
        })
        .sort(() => 0.5 - Math.random())
        .slice(0, 4);

        if (related.length) {
            const slugs = related.map(x => x.title.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-').replace(/^-+|-+$/g, ''));
            document.getElementById('relatedSection').innerHTML = `
                <h5 class="mb-4">You may also like</h5>
                <div class="row g-3">
                    ${related.map((x, i) => `
                        <div class="col-6 col-md-3">
                            <a href="/static-posters/${slugs[i]}.html" class="related-item d-block">
                                <img src="/${x.thumbnail}" alt="${esc(x.title)}" class="img-fluid mb-1">
                                <div class="title text-muted small">${esc(x.title)}</div>
                            </a>
                        </div>
                    `).join('')}
                </div>
            `;
        }
    })
    .catch(e => console.error('Related fetch error:', e));

// Add to cart – uses cqp.js (no alerts, no duplicate code)
document.getElementById('addToCart').addEventListener('click', () => {
    addToCart({
        id: poster.product_id,
        title: poster.title,
        price: poster.price,
        thumbnail: poster.thumbnail
    });
    updateCartBadge(true);
});

// Slideshow functions
function prevImage() {
    currentIndex = (currentIndex - 1 + images.length) % images.length;
    document.getElementById('mainImg').src = '/' + images[currentIndex];
    updateDots();
}
function nextImage() {
    currentIndex = (currentIndex + 1) % images.length;
    document.getElementById('mainImg').src = '/' + images[currentIndex];
    updateDots();
}
function selectImage(i) {
    currentIndex = i;
    document.getElementById('mainImg').src = '/' + images[currentIndex];
    updateDots();
}
function updateDots() {
    document.querySelectorAll('.dot').forEach((dot, i) => dot.classList.toggle('active', i === currentIndex));
}

function openLightbox(i) {
    currentIndex = i;
    modalImg.src = '/' + images[currentIndex];
    modalThumbs.innerHTML = images.map((img, j) => `
        <img src="/${img}" class="${j === currentIndex ? 'active' : ''}" onclick="selectModalImage(${j})">
    `).join('');
    resetZoom();
    modal.show();
}
function selectModalImage(i) {
    currentIndex = i;
    modalImg.src = '/' + images[currentIndex];
    modalThumbs.querySelectorAll('img').forEach((thumb, j) => thumb.classList.toggle('active', j === i));
    resetZoom();
}

// Zoom / pan
function toggleZoom() {
    isZoomActive = !isZoomActive;
    scale = isZoomActive ? 2 : 1;
    posX = posY = 0;
    modalImgContainer.classList.toggle('zoom-active', isZoomActive);
    modalImg.classList.toggle('zoom-active', isZoomActive);
    updateTransform();
    zoomBtn.innerHTML = isZoomActive ? '<i class="bi bi-zoom-out"></i>' : '<i class="bi bi-zoom-in"></i>';
}
function resetZoom() {
    if (isZoomActive) toggleZoom();
}
function updateTransform() {
    modalImg.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
}

// Drag to pan
modalImgContainer.addEventListener('pointerdown', e => {
    if (!isZoomActive) return;
    modalImgContainer.setPointerCapture(e.pointerId);
    isDragging = true;
    lastX = e.clientX - posX;
    lastY = e.clientY - posY;
    modalImgContainer.style.cursor = 'grabbing';
});
modalImgContainer.addEventListener('pointermove', e => {
    if (!isDragging) return;
    posX = e.clientX - lastX;
    posY = e.clientY - lastY;
    clampPosition();
    updateTransform();
});
modalImgContainer.addEventListener('pointerup', () => { isDragging = false; modalImgContainer.style.cursor = isZoomActive ? 'grab' : 'default'; });
modalImgContainer.addEventListener('pointerleave', () => { isDragging = false; });

// Clamp
function clampPosition() {
    const imgRect = modalImg.getBoundingClientRect();
    const boxRect = modalImgContainer.getBoundingClientRect();
    const maxX = Math.max(0, (imgRect.width - boxRect.width) / 2);
    const maxY = Math.max(0, (imgRect.height - boxRect.height) / 2);
    posX = Math.max(-maxX, Math.min(maxX, posX));
    posY = Math.max(-maxY, Math.min(maxY, posY));
}

// Fullscreen
fsBtn.addEventListener('click', () => {
    document.fullscreenElement ? document.exitFullscreen() : document.documentElement.requestFullscreen();
});

// Cleanup
modal._element.addEventListener('hidden.bs.modal', resetZoom);

// Anti-download
// Move this after all click/zoom listeners to avoid interference
document.addEventListener('contextmenu', e => {
    if (e.target.tagName === 'IMG' && (e.target.id === 'mainImg' || e.target.id === 'modalImage' || e.target.classList.contains('modal-thumb'))) {
        e.preventDefault();
    }
}, { capture: true }); // Capture to ensure but allow bubble

const protectedImages = document.querySelectorAll('#mainImg, #modalImage, .modal-thumbs img');
protectedImages.forEach(img => {
    img.draggable = false;
    img.addEventListener('dragstart', e => e.preventDefault());
});

// Ensure mainImg click works
const mainImg = document.getElementById('mainImg');
mainImg.style.pointerEvents = 'auto'; // Ensure clickable
mainImg.addEventListener('click', () => {
    openLightbox(currentIndex); // Assuming openLightbox is your modal open func
}, { passive: true });

// For zoom in fullscreen: Assuming #zoomToggle is the icon
const zoomToggle = document.getElementById('zoomToggle');
if (zoomToggle) {
    zoomToggle.style.pointerEvents = 'auto';
}
</script>

<!-- FOOTER -->
<footer class="site-footer mt-5">
    <div class="container py-4">
        <div class="row gy-3 align-items-center">
            <div class="col-md-4 footer-left">
                <a href="/shop.html">
                    <img src="/img/logo.png" alt="Cinema Quad Posters" class="footer-logo">
                </a>
            </div>
            <div class="col-md-4 text-center">
                <ul class="footer-links justify-content-center mb-1">
                    <li><a href="/shop.html">Shop</a></li>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/faq.html">FAQs</a></li>
                    <li><a href="/terms.html">Terms</a></li>
                </ul>
                <p class="small mb-0" style="color: #aaa;">    
                    © <span id="year"></span> Cinema Quad Posters
                </p>
            </div>
        </div>
    </div>
</footer>

<script>
document.getElementById('year').textContent = new Date().getFullYear();
</script>

<script src="/cqp.js"></script>

</body>
</html>